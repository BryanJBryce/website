<!DOCTYPE html>
<html>
  <head>
    <title>UITableViewCell height with UITextView | Dennis Reimann, Softwareentwickler</title>
    <script src='/javascripts/head.min.js'></script>
    <script type='text/javascript'>
      //<![CDATA[
        head.js(
          "https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js",
          "http://www.google-analytics.com/ga.js",
          "/fancybox/jquery.fancybox-1.3.4.pack.js",
          "/fancybox/jquery.easing-1.3.pack.js",
          "/javascripts/website.js",
          function(){Website.init()});
      //]]>
    </script>
    <link href='/atom.xml' rel='alternate' title='//dennisreimann' type='application/atom+xml' />
    <link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css' />
    <link href='/stylesheets/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <link href='http://dennisreimann.de/blog/uitextview-height-in-uitableviewcell' rel='canonical' />
    <link href='http://openid.dennisreimann.de/server' rel='openid2.provider openid.server' />
    <link href='http://openid.dennisreimann.de/dennisreimann' rel='openid2.local_id openid.delegate' />
    <!--[if IE]>
      <link href='/stylesheets/ie.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <![endif]-->
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta content='BRi3ql7JvxxFP2KtBRHIV6Rfzn0ZN7xJF1NNtnEUaI8' name='google-site-verification' />
    <meta content='app-id=669642611,affiliate-data=10l5ET' name='apple-itunes-app' />
    <meta content='A short snippet of code to calculate the height of a UITableViewCell based on an inner UITextView with dynamic height' name='description' />
    <meta content='Cocoa, iPhone, iPad, iOS, Objective-C, UITableViewCell, UITextView, height' name='keywords' />
  </head>
  <body>
    <div id="header">
      <div id='identity'>
        <a href='/' id='logo'>
          <span id='slashes'>//</span>
          <span id='name'>dennisreimann</span>
        </a>
        <div id='claim'>
          Software developer
        </div>
      </div>
    </div>
    <div id="main">
      <article>
        <header>
          <time class='pubdate' datetime='2012-12-03T10:30:00+01:00'>
            <div class='top'>Dec '12</div>
            <div class='day'> 3</div>
          </time>
          <h1>UITableViewCell height with UITextView</h1>
        </header>
        <div class='content'><p>You will find lots of resources on the internet about calculating the height of a UITableViewCell based&#x000A;on an inner UITextView. Most of what I&#8217;ve found when I was trying to find a solution was either incomplete&#x000A;or wrong. Here are my learnings and the approach I&#8217;m taking to tame what gave me headaches for some time now.</p>&#x000A;&#x000A;<h3>Prerequisites</h3>&#x000A;&#x000A;<p>I wanted this to work for <em>both table view styles</em> within <em>universal apps</em> that support <em>autorotation</em>.&#x000A;The solution should also be flexible enough to allow for subclassing and configuration of the custom&#x000A;table view cell so that I can reuse the code for different kinds of cells.</p>&#x000A;&#x000A;<h4>UITableViewCell</h4>&#x000A;&#x000A;<p>To calculate the height of the cell (most likely to be used in <code>tableView: heightForRowAtIndexPath:</code>) you&#x000A;have to know its width so that you can calculate the size of the UITextView with the method&#x000A;<code>sizeWithFont:forWidth: lineBreakMode:</code> provided by the NSString class. That is because the naive approach&#x000A;of adding the cell to the table view and asking for the frame size of the text view does not work -&#x000A;<code>tableView:heightForRowAtIndexPath:</code> gets called before <code>tableView:cellForRowAtIndexPath:</code> so that you have&#x000A;to do the calculation on your own.</p>&#x000A;&#x000A;<h4>UITextView</h4>&#x000A;&#x000A;<p>First of all we have to notice that an UITextView has an inset of 8px on each side. I have not found&#x000A;official documetation about this and event though its <code>contentInset</code> property is set to <code>UIEdgeInsetZero</code>&#x000A;by default, it has this 16px horizontal padding we have to subtract when calculating with the text views width.</p>&#x000A;&#x000A;<p><strong>Note:</strong> On StackOverflow and elsewhere you can find remarks about reduzing the padding by applying a custom&#x000A;inset with negative values, like this:</p>&#x000A;&#x000A;<div class="highlight"><pre><span class="n">textView</span><span class="p">.</span><span class="n">contentInset</span> <span class="o">=</span> <span class="n">UIEdgeInsetsMake</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>This indeed unsets the visual padding, but from what I have seen and tested it does not make the text run wider&#x000A;- you still have to subtract the 16px. With this example the text just seems to start 8px more to the left,&#x000A;but still wraps at the original width.</p>&#x000A;&#x000A;<h3>The approach</h3>&#x000A;&#x000A;<p>There is one thing I don&#8217;t really like about the solution I&#8217;ve found and that is passing in the table view&#x000A;to the method <code>- (CGFloat)heightForTableView:(UITableView *)tableView</code> that does the calculation. However&#x000A;I did not find a way to avoid this, because we need the width of the cells outer frame, because it will give&#x000A;us a way to get to the cells width - this way it works with autorotation and cell reuse.</p>&#x000A;&#x000A;<p>The code for the custom UITableViewCell subclass (<code>TextCell</code>) looks like this:</p>&#x000A;&#x000A;<div class="highlight"><pre><span class="k">@implementation</span> <span class="nc">TextCell</span>&#x000A;&#x000A;<span class="c1">// UITextView has an inset of 8px on each side</span>&#x000A;<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">textInset</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="mf">8.0f</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="c1">// Sets the text and adjusts the frame height</span>&#x000A;<span class="c1">// so that the text view does not scroll</span>&#x000A;<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setContentText:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">theText</span> <span class="p">{</span>&#x000A;    <span class="n">self</span><span class="p">.</span><span class="n">textView</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">theText</span><span class="p">;</span>&#x000A;    <span class="n">CGRect</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">textView</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">cHeight</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">textView</span><span class="p">.</span><span class="n">contentSize</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>&#x000A;    <span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">cHeight</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">textInset</span><span class="p">;</span>&#x000A;    <span class="n">self</span><span class="p">.</span><span class="n">textView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="c1">// Calculates the text views width by subtracting</span>&#x000A;<span class="c1">// the horizontal insets and margins</span>&#x000A;<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">textWidthForOuterWidth:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">outerWidth</span> <span class="p">{</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">textInset</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">textInset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">marginH</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">marginLeft</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">marginRight</span><span class="p">;</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">width</span> <span class="o">=</span> <span class="n">outerWidth</span> <span class="o">-</span> <span class="n">marginH</span><span class="p">;</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">textWidth</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">textInset</span><span class="p">;</span>&#x000A;    <span class="k">return</span> <span class="n">textWidth</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">heightForTableView:</span><span class="p">(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="p">{</span>&#x000A;    <span class="c1">// calculate the outer width of the cell</span>&#x000A;    <span class="c1">// based on the tableView style</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">outerWidth</span> <span class="o">=</span> <span class="n">tableView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>&#x000A;    <span class="k">if</span> <span class="p">(</span><span class="n">tableView</span><span class="p">.</span><span class="n">style</span> <span class="o">==</span> <span class="n">UITableViewStyleGrouped</span><span class="p">)</span> <span class="p">{</span>&#x000A;        <span class="c1">// the grouped table inset is 20px on</span>&#x000A;        <span class="c1">// the iPhone and 90px on the iPad</span>&#x000A;        <span class="kt">BOOL</span> <span class="n">iPad</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIDevice</span> <span class="n">currentDevice</span><span class="p">].</span><span class="n">userInterfaceIdiom</span> <span class="o">==</span>&#x000A;          <span class="n">UIUserInterfaceIdiomPhone</span><span class="p">;</span>&#x000A;        <span class="n">outerWidth</span> <span class="o">-=</span> <span class="n">iPad</span> <span class="o">?</span> <span class="mf">20.0f</span> <span class="o">:</span> <span class="mf">90.0f</span><span class="p">;</span>&#x000A;    <span class="p">}</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">textInset</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">textInset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">marginV</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">marginTop</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">marginBottom</span><span class="p">;</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">textWidth</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">textWidthForOuterWidth</span><span class="o">:</span><span class="n">outerWidth</span><span class="p">];</span>&#x000A;    <span class="c1">// use large value to avoid scrolling</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">maxHeight</span> <span class="o">=</span> <span class="mf">50000.0f</span><span class="p">;</span>&#x000A;    <span class="n">CGSize</span> <span class="n">constraint</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">textWidth</span><span class="p">,</span> <span class="n">maxHeight</span><span class="p">);</span>&#x000A;    <span class="n">CGSize</span> <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">textView</span><span class="p">.</span><span class="n">text</span>&#x000A;        <span class="nl">sizeWithFont:</span><span class="n">self</span><span class="p">.</span><span class="n">textView</span><span class="p">.</span><span class="n">font</span>&#x000A;        <span class="nl">constrainedToSize:</span><span class="n">constraint</span>&#x000A;        <span class="nl">lineBreakMode:</span><span class="n">UILineBreakModeWordWrap</span><span class="p">];</span>&#x000A;    <span class="n">CGFloat</span> <span class="n">height</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">textInset</span> <span class="o">+</span> <span class="n">marginV</span><span class="p">;</span>&#x000A;    <span class="k">return</span> <span class="n">height</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="k">@end</span>&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>You may have noticed, that the code above refers to getters for the margin. I use these&#x000A;to configure the coordinates that text views in different kinds of <code>TextCell</code> subclasses&#x000A;may have.</p>&#x000A;&#x000A;<p><img src="/images/content/uitextview-interface_builder.png" alt="Cellconfiguration in Interface Builder" /></p>&#x000A;&#x000A;<p>For example I would use these settings in a concrete subclass when the UITextView&#x000A;in Interface Builder is set like in the screenshot above.</p>&#x000A;&#x000A;<div class="highlight"><pre><span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">marginTop</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="mf">65.0f</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">marginBottom</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="mf">40.0f</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">marginLeft</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="mf">1.0f</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;&#x000A;<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">marginRight</span> <span class="p">{</span>&#x000A;    <span class="k">return</span> <span class="mf">1.0f</span><span class="p">;</span>&#x000A;<span class="p">}</span>&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>The code and examples for this are taken from the <a href="https://github.com/dennisreimann/ioctocat/blob/8e5544b109fb6221eaf01ce25651df76ca5cf5f1/Classes/TextCell.m">iOctocat codebase</a>.</p></div>
        <div class='follow'>
          <p>
            Liked this post? Follow me on
            <a class="twitter" href="https://twitter.com/dennisreimann">Twitter</a>
            or
            <a class="github" href="https://github.com/dennisreimann">GitHub</a>
          </p>
        </div>
        <div class='teaser' id='iOctocat' itemscope='itemscope' itemtype='http://schema.org/SoftwareApplication'>
          <a href='http://ioctocat.com'>
            <img alt='iPhone app for GitHub' itemprop='image' src='/images/ioctocat.png' />
          </a>
          <h3 itemprop='name'>
            <a href='http://ioctocat.com'>
              iOctocat
            </a>
          </h3>
          <p itemprop='description'>
            is GitHub in your pocket: The go to app for staying up to date with your
            projects on your
            <span itemprop='device'>iPhone, and iPod Touch.</span>
            <br />
            It is
            <a href="http://ioctocat.com/appstore-iphone" itemprop="url">available on the App Store</a>
          </p>
          <link href='http://schema.org/SocialNetworkingApplication' itemprop='SoftwareApplicationCategory' />
        </div>
      </article>
    </div>
    <div id="footer">
      <div class='vcard' id='contact'>
        <span class='fn'>Dennis Reimann</span>
        <p class='adr'>
          <span class='street-address'>Ottjen-Alldag-Str. 32</span>
          <br />
          <span class='postal-code'>D-28277</span>
          <span class='locality'>Bremen</span>
        </p>
        <p>
          <span class='web'><a class="url" href="http://dennisreimann.de/" rel="me">dennisreimann.de</a></span>
          <br />
          <span class='mail'><a class="email" href="mailto:mail@dennisreimann.de" rel="me">mail@dennisreimann.de</a></span>
          <br />
          <span class='tel'>+49 (0)151 22 63 03 17</span>
        </p>
        <p>
          <small><a href="/contact">Contact details</a></small>
        </p>
        <ul class='social'>
          <li><a href="https://github.com/dennisreimann" rel="me">GitHub</a></li>
          <li><a href="https://twitter.com/dennisreimann" rel="me">Twitter</a></li>
          <li><a href="http://www.xing.com/profile/Dennis_Reimann5" rel="me">XING</a></li>
        </ul>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-376258-21']);
        _gaq.push(['_gat._anonymizeIp']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
        })();
      //]]>
    </script>
  </body>
</html>
