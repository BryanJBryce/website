<!DOCTYPE html>
<html>
  <head>
    <title>Rails: Performancesteigerung durch Piggy Backing | Dennis Reimann, Softwareentwickler</title>
    <script src='/javascripts/head.min.js'></script>
    <script type='text/javascript'>
      //<![CDATA[
        head.js(
          "https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js",
          "http://www.google-analytics.com/ga.js",
          "/fancybox/jquery.fancybox-1.3.4.pack.js",
          "/fancybox/jquery.easing-1.3.pack.js",
          "/javascripts/website.js",
          function(){Website.init()});
      //]]>
    </script>
    <link href='/atom.xml' rel='alternate' title='//dennisreimann' type='application/atom+xml' />
    <link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css' />
    <link href='/stylesheets/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <link href='http://dennisreimann.de/blog/rails-performancesteigerung-durch-piggy-backing' rel='canonical' />
    <link href='http://openid.dennisreimann.de/server' rel='openid2.provider openid.server' />
    <link href='http://openid.dennisreimann.de/dennisreimann' rel='openid2.local_id openid.delegate' />
    <!--[if IE]>
      <link href='/stylesheets/ie.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <![endif]-->
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta content='BRi3ql7JvxxFP2KtBRHIV6Rfzn0ZN7xJF1NNtnEUaI8' name='google-site-verification' />
    <meta content='app-id=669642611,affiliate-data=10l5ET' name='apple-itunes-app' />
    <meta content='Die Technik ist nicht neu, aber gestern beim Treffen der Ruby On Rails Usergroup Hamburg erntete ich einige komische Blicke, als ich in kleiner Runde vom „Piggy Backing“ erzählte, daher hier nochmal etwas genauer erklärt worum es geht.&#x000A;&#x000A;Piggy Backing - so bescheuert der Name dieser Technik klingt (bedeutet eingedeutscht wohl so etwas wie Huckepack tragen), so gut erklärt er eigentlich genau das was damit gemacht wird - und von Stefan Kaes gibt es sogar eine Erweiterung von ActiveRecord dafür - so komisch kann es also nicht sein ;) ' name='description' />
    <meta content='Ruby on Rails' name='keywords' />
  </head>
  <body>
    <div id="header">
      <div id='identity'>
        <a href='/' id='logo'>
          <span id='slashes'>//</span>
          <span id='name'>dennisreimann</span>
        </a>
        <div id='claim'>
          Softwareentwickler
        </div>
      </div>
    </div>
    <div id="main">
      <article>
        <header>
          <time class='pubdate' datetime='2007-04-26T13:58:00+02:00'>
            <div class='top'>Apr '07</div>
            <div class='day'>26</div>
          </time>
          <h1>Rails: Performancesteigerung durch Piggy Backing</h1>
        </header>
        <div class='content'><p>Die Technik ist nicht neu, aber gestern beim Treffen der <a href="http://www.rubyonrails-ug.de/wiki/hamburg">Ruby On Rails Usergroup Hamburg</a> erntete ich einige komische Blicke, als ich in kleiner Runde vom „Piggy Backing“ erzählte, daher hier nochmal etwas genauer erklärt worum es geht.</p>&#x000A;&#x000A;<p>Piggy Backing - so bescheuert der Name dieser Technik klingt (bedeutet eingedeutscht wohl so etwas wie Huckepack tragen), so gut erklärt er eigentlich genau das was damit gemacht wird - und von Stefan Kaes gibt es sogar eine <a href="http://railsexpress.de/blog/articles/2006/05/29/simpler-piggy-backing">Erweiterung von ActiveRecord dafür</a> - so komisch kann es also nicht sein ;)</p>&#x000A;&#x000A;<!--more-->&#x000A;&#x000A;&#x000A;<p>Konkret geht es darum, beim Laden von Objekten aus der Datenbank direkt ein paar Attribute anderer Objekte mitzuladen. Ich erkläre es mal am Beispiel von <a href="http://beta.wevent.org">wevent</a>, weil wir es dort kürzlich eingebaut haben und uns dadurch einiges an Performancezugewinn sichern.</p>&#x000A;&#x000A;<h4>Achtung, es folgen verkomplizierte Beschreibungen</h4>&#x000A;&#x000A;&#x000A;<p>Wir haben eine Tabelle mit den Events, zu denen auch die Modelle Stadt und Location gehören. Wenn wir die Events für die Darstellung in einer Liste laden, wollen wir dazu auch direkt die jeweilige Location und ihre Stadt ziehen - soweit nichts besonderes und in ActiveRecord einfach durch etwas wie folgendes zu lösen:</p>&#x000A;&#x000A;<p>Dadurch werden die mit einem Event verknüpfte Location und Stadt direkt mitgeladen - in unserem Falle ist das so aber nicht wirklich ideal: Erstens wird Performance auf Datenbankseite verschenkt, da die kompletten Stadt- und Location-Objekte geladen werden (wir brauchen nur den Namen) und zweitens, weil diese Objekte nach dem Laden auch komplett von Ruby initialisiert werden müssen, was auf Interpreterseite Zeit kostet.</p>&#x000A;&#x000A;<p>Was wir also brauchen ist die Möglichkeit, den <code>venue_name</code> und <code>city_name</code> als Attribute des Eventobjekts zu laden. Dafür müssen zwar auf Datenbankebene immer noch die Stadt- und Location-Tabellen gejoint werden, allerdings holen wir dieses Mal nur den Namen und nicht das ganze Objekt&#8230; außerdem müssen nach dem Laden keine Stadt- und Location-Instanzen erzeugt werden (die Namen sind ja Attribute des Eventobjekts). Wie funktioniert das?</p>&#x000A;&#x000A;<h4>Attached at the hip</h4>&#x000A;&#x000A;&#x000A;<p>In der Praxis läufts folgendermaßen: Die Abfrage muss angepasst werden, um die nötigen Tabellen zu joinen und die zusätzlichen Attribute zu laden:</p>&#x000A;&#x000A;<p>Uff, sieht ja gar nicht mehr so schön Rails-like aus - stimmt! Wenn man sich dafür aber mal Stefan Kaes&#8217; Performancevergleich in der <a href="http://railsexpress.de/blog/articles/2005/11/06/the-case-for-piggy-backed-attributes">Gegenüberstellung von Laden per <code>:include</code> und Piggy Backing</a> ansieht, dann kann man diese Schönheitseinbußen durchaus in Erwägung ziehen.</p>&#x000A;&#x000A;<p>Wer jetzt noch nicht abgeschreckt ist, der muss sein Modell noch etwas anpassen, um auf die zusätzlichen Attribute auch zugreifen zu können. In unserem Fall müsste das Eventmodell um zwei Methoden erweitert werden, welche den Zugriff auf dem Stadt- und Location-Namen regeln:</p>&#x000A;&#x000A;<p>Was passiert da genau? Diese Methoden garantieren mir, dass ich bei einem Event auf jeden Fall an die Eigenschafft komme, die ich haben möchte: Ist beim Zugriff auf <code>@event.venue_name</code> das per Piggy Backing geladene Attribut <code>venue_name</code> vorhanden, wird dieses zurückgegeben, ohne einen Zugriff auf die Datenbank. Ist es nicht vorhanden (bspw. weil der Event an anderer Stelle ohne Piggy Backing geladen wurde), so wird die per Assoziation (Event <code>belongs_to :venue</code>) festgelegte Location aus der Datenbank geladen und ihr Name zurückgegeben.</p>&#x000A;&#x000A;<p>Klingt theoretisch viel komplizierter als es praktisch ist und es macht teilweise echt Sinn, solche Probleme auf diese Art und Weise zu lösen.</p></div>
        <div class='follow'>
          <p>
            Guter Artikel? Folge mir auf
            <a class="twitter" href="https://twitter.com/dennisreimann">Twitter</a>
            oder
            <a class="github" href="https://github.com/dennisreimann">GitHub</a>
          </p>
        </div>
        <div class='teaser' id='iOctocat' itemscope='itemscope' itemtype='http://schema.org/SoftwareApplication'>
          <a href='http://ioctocat.com'>
            <img alt='iOS app for GitHub' itemprop='image' src='/images/ioctocat.png' />
          </a>
          <h3 itemprop='name'>
            <a href='http://ioctocat.com'>iOctocat</a>
          </h3>
          <p itemprop='description'>
            ist GitHub für die Hosentasche - deine Projekte und das was dort passiert
            immer dabei mit deinem
            <span itemprop='device'>iPhone und iPod Touch.</span>
            <br />
            Die App ist
            <a href="http://ioctocat.com/appstore-iphone" itemprop="url">im App Store erhältlich</a>
          </p>
          <link href='http://schema.org/SocialNetworkingApplication' itemprop='SoftwareApplicationCategory' />
        </div>
      </article>
    </div>
    <div id="footer">
      <div class='vcard' id='contact'>
        <span class='fn'>Dennis Reimann</span>
        <p class='adr'>
          <span class='street-address'>Ottjen-Alldag-Str. 32</span>
          <br />
          <span class='postal-code'>D-28277</span>
          <span class='locality'>Bremen</span>
        </p>
        <p>
          <span class='web'><a class="url" href="http://dennisreimann.de/" rel="me">dennisreimann.de</a></span>
          <br />
          <span class='mail'><a class="email" href="mailto:mail@dennisreimann.de" rel="me">mail@dennisreimann.de</a></span>
          <br />
          <span class='tel'>+49 (0)151 22 63 03 17</span>
        </p>
        <p>
          <small><a href="/contact">Kontaktdetails</a></small>
        </p>
        <ul class='social'>
          <li><a href="https://github.com/dennisreimann" rel="me">GitHub</a></li>
          <li><a href="https://twitter.com/dennisreimann" rel="me">Twitter</a></li>
          <li><a href="http://www.xing.com/profile/Dennis_Reimann5" rel="me">XING</a></li>
        </ul>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-376258-21']);
        _gaq.push(['_gat._anonymizeIp']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
        })();
      //]]>
    </script>
  </body>
</html>
