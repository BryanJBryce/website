<!DOCTYPE html>
<html>
  <head>
    <title>Substituting before_filter :load_object | Dennis Reimann, Softwareentwickler</title>
    <script src='/javascripts/head.min.js'></script>
    <script type='text/javascript'>
      //<![CDATA[
        head.js(
          "https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js",
          "http://www.google-analytics.com/ga.js",
          "/fancybox/jquery.fancybox-1.3.4.pack.js",
          "/fancybox/jquery.easing-1.3.pack.js",
          "/javascripts/website.js",
          function(){Website.init()});
      //]]>
    </script>
    <link href='/atom.xml' rel='alternate' title='//dennisreimann' type='application/atom+xml' />
    <link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css' />
    <link href='/stylesheets/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <link href='http://dennisreimann.de/blog/substituting-before_filter-load_object' rel='canonical' />
    <link href='http://openid.dennisreimann.de/server' rel='openid2.provider openid.server' />
    <link href='http://openid.dennisreimann.de/dennisreimann' rel='openid2.local_id openid.delegate' />
    <!--[if IE]>
      <link href='/stylesheets/ie.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <![endif]-->
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta content='BRi3ql7JvxxFP2KtBRHIV6Rfzn0ZN7xJF1NNtnEUaI8' name='google-site-verification' />
    <meta content='app-id=669642611,affiliate-data=10l5ET' name='apple-itunes-app' />
    <meta content='Softwareentwicklung mit HTML5' name='description' />
    <meta content='Ruby on Rails, Rails, Ruby, Controller, Action, before_filter' name='keywords' />
  </head>
  <body>
    <div id="header">
      <div id='identity'>
        <a href='/' id='logo'>
          <span id='slashes'>//</span>
          <span id='name'>dennisreimann</span>
        </a>
        <div id='claim'>
          Software developer
        </div>
      </div>
    </div>
    <div id="main">
      <article>
        <header>
          <time class='pubdate' datetime='2010-10-11T19:37:00+02:00'>
            <div class='top'>Oct '10</div>
            <div class='day'>11</div>
          </time>
          <h1>Substituting before_filter :load_object</h1>
        </header>
        <div class='content'><p>Here&#8217;s a Rails controller pattern I&#8217;m using more often lately: Instead of loading an object with a <code>before_filter</code> you can use a more intelligent <code>helper_method</code> to get the main object for the controller context. It already sounds more complicated than it is, so here&#8217;s an example:</p>&#x000A;&#x000A;<h4>Before</h4>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">ProductController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="n">before_filter</span> <span class="ss">:load_product</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>&#x000A;&#x000A;  <span class="c1"># your standard CRUD methods here…</span>&#x000A;&#x000A;  <span class="kp">private</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">load_product</span>&#x000A;    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>This is pretty straight forward and I assume everyone has done that already, here&#8217;s a <em>imho</em> nicer approach…</p>&#x000A;&#x000A;<h4>After</h4>&#x000A;&#x000A;&#x000A;&#x000A;&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">ProductController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="n">helper_method</span> <span class="ss">:product</span>&#x000A;&#x000A;  <span class="err">…</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">create</span>&#x000A;    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>&#x000A;      <span class="k">if</span> <span class="n">product</span><span class="o">.</span><span class="n">save</span>&#x000A;        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">product</span> <span class="p">}</span>&#x000A;      <span class="k">else</span>&#x000A;        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="s2">&quot;new&quot;</span> <span class="p">}</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">update</span>&#x000A;    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>&#x000A;      <span class="k">if</span> <span class="n">product</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>&#x000A;        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">product</span> <span class="p">}</span>&#x000A;      <span class="k">else</span>&#x000A;        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="s2">&quot;edit&quot;</span> <span class="p">}</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">destroy</span>&#x000A;    <span class="n">product</span><span class="o">.</span><span class="n">destroy</span>&#x000A;&#x000A;    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>&#x000A;      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">products_url</span> <span class="p">}</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="kp">private</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">product</span>&#x000A;    <span class="vi">@product</span> <span class="o">||=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span> <span class="p">?</span> <span class="no">Product</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="no">Product</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>And beacause it is a helper method you can use it in your views just like that, for example in conjunction with a form:</p>&#x000A;&#x000A;<div class="highlight"><pre><span class="nt">%h1</span> New product&#x000A;&#x000A;<span class="p">-</span> <span class="n">form_for</span> <span class="n">product</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>&#x000A;  …&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>Of course you can adjust the helper method to fit your needs, maybe you need it to provide a nested object:</p>&#x000A;&#x000A;<div class="highlight"><pre><span class="k">class</span> <span class="nc">ProductController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="n">helper_method</span> <span class="ss">:category</span><span class="p">,</span> <span class="ss">:product</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">index</span>&#x000A;    <span class="vi">@products</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">products</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="c1"># you get the idea…</span>&#x000A;&#x000A;  <span class="kp">private</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">catalog</span>&#x000A;    <span class="vi">@catalog</span> <span class="o">||=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:catalog_id</span><span class="o">]</span> <span class="p">?</span> <span class="no">Catalog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:catalog_id</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="no">Catalog</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:catalog</span><span class="o">]</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">product</span>&#x000A;    <span class="vi">@product</span> <span class="o">||=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span> <span class="p">?</span> <span class="n">catalog</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span> <span class="p">:</span> <span class="n">catalog</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;</div>
        <div class='follow'>
          <p>
            Liked this post? Follow me on
            <a class="twitter" href="https://twitter.com/dennisreimann">Twitter</a>
            or
            <a class="github" href="https://github.com/dennisreimann">GitHub</a>
          </p>
        </div>
        <div class='teaser' id='iOctocat' itemscope='itemscope' itemtype='http://schema.org/SoftwareApplication'>
          <a href='http://ioctocat.com'>
            <img alt='iPhone app for GitHub' itemprop='image' src='/images/ioctocat.png' />
          </a>
          <h3 itemprop='name'>
            <a href='http://ioctocat.com'>
              iOctocat
            </a>
          </h3>
          <p itemprop='description'>
            is GitHub in your pocket: The go to app for staying up to date with your
            projects on your
            <span itemprop='device'>iPhone, and iPod Touch.</span>
            <br />
            It is
            <a href="http://ioctocat.com/appstore-iphone" itemprop="url">available on the App Store</a>
          </p>
          <link href='http://schema.org/SocialNetworkingApplication' itemprop='SoftwareApplicationCategory' />
        </div>
      </article>
    </div>
    <div id="footer">
      <div class='vcard' id='contact'>
        <span class='fn'>Dennis Reimann</span>
        <p class='adr'>
          <span class='street-address'>Ottjen-Alldag-Str. 32</span>
          <br />
          <span class='postal-code'>D-28277</span>
          <span class='locality'>Bremen</span>
        </p>
        <p>
          <span class='web'><a class="url" href="http://dennisreimann.de/" rel="me">dennisreimann.de</a></span>
          <br />
          <span class='mail'><a class="email" href="mailto:mail@dennisreimann.de" rel="me">mail@dennisreimann.de</a></span>
          <br />
          <span class='tel'>+49 (0)151 22 63 03 17</span>
        </p>
        <p>
          <small><a href="/contact">Contact details</a></small>
        </p>
        <ul class='social'>
          <li><a href="https://github.com/dennisreimann" rel="me">GitHub</a></li>
          <li><a href="https://twitter.com/dennisreimann" rel="me">Twitter</a></li>
          <li><a href="http://www.xing.com/profile/Dennis_Reimann5" rel="me">XING</a></li>
        </ul>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-376258-21']);
        _gaq.push(['_gat._anonymizeIp']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
        })();
      //]]>
    </script>
  </body>
</html>
