<!DOCTYPE html>
<html>
  <head>
    <title>Setting up Ubuntu with Teleport | Dennis Reimann, Softwareentwickler</title>
    <script src='/javascripts/head.min.js'></script>
    <script type='text/javascript'>
      //<![CDATA[
        head.js(
          "https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js",
          "http://www.google-analytics.com/ga.js",
          "/fancybox/jquery.fancybox-1.3.4.pack.js",
          "/fancybox/jquery.easing-1.3.pack.js",
          "/javascripts/website.js",
          function(){Website.init()});
      //]]>
    </script>
    <link href='/atom.xml' rel='alternate' title='//dennisreimann' type='application/atom+xml' />
    <link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css' />
    <link href='/stylesheets/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <link href='http://dennisreimann.de/blog/setting-up-ubuntu-with-teleport' rel='canonical' />
    <link href='http://openid.dennisreimann.de/server' rel='openid2.provider openid.server' />
    <link href='http://openid.dennisreimann.de/dennisreimann' rel='openid2.local_id openid.delegate' />
    <!--[if IE]>
      <link href='/stylesheets/ie.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <![endif]-->
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta content='BRi3ql7JvxxFP2KtBRHIV6Rfzn0ZN7xJF1NNtnEUaI8' name='google-site-verification' />
    <meta content='app-id=669642611,affiliate-data=10l5ET' name='apple-itunes-app' />
    <meta content='Software mit JavaScript' name='description' />
    <meta content='Rails, Ruby, Ruby on Rails, Deployment, Teleport, gems, Chef, Puppet' name='keywords' />
  </head>
  <body>
    <div id="header">
      <div id='identity'>
        <a href='/' id='logo'>
          <span id='slashes'>//</span>
          <span id='name'>dennisreimann</span>
        </a>
        <div id='claim'>
          Software developer
        </div>
      </div>
    </div>
    <div id="main">
      <article>
        <header>
          <time class='pubdate' datetime='2011-11-15T14:15:00+01:00'>
            <div class='top'>Nov '11</div>
            <div class='day'>15</div>
          </time>
          <hgroup>
            <h1>Setting up Ubuntu with Teleport</h1>
            <h2>A lightweight yet powerful way for preparing machines to deploy ruby apps</h2>
          </hgroup>
        </header>
        <div class='content'><p>Some time ago I came across <a href="https://github.com/gurgeous/teleport">Teleport</a> which pitches itself as a lightweight way to set up Ubuntu machines. Having failed at mastering the steep learning curve that full-blown tools like <a href="http://www.opscode.com/chef/">Chef</a> or <a href="http://projects.puppetlabs.com/projects/puppet">Puppet</a> provide, I was willing to give Teleport a shot. Teleport stays simple by focusing on Ubuntu and providing just the right set of tools to set up the whole Ruby/Rails eco system. This makes it less powerful than the other aforemention tools, but in my case it&#8217;s just what I was looking for.</p>&#x000A;&#x000A;<h3>Some facts: Teleport …</h3>&#x000A;&#x000A;<ul>&#x000A;<li>consists of a configuration (Telfile) plus files you want to be present on the target</li>&#x000A;<li>copies itself onto the target via ssh and then runs itself there (hence the name)</li>&#x000A;<li>works idempotently - run it over and over again without breaking the target</li>&#x000A;</ul>&#x000A;&#x000A;&#x000A;<h3>My setup</h3>&#x000A;&#x000A;<p>For each project I store everything that belongs to Teleport in a specific <code>deployment</code> folder. This folder might look something like this:</p>&#x000A;&#x000A;<pre><code>|____Telfile&#x000A;|____recipes&#x000A;| |____install_passenger_nginx.rb&#x000A;|____files&#x000A;| |____etc&#x000A;| | |____gemrc&#x000A;| | |____init.d&#x000A;| | | |____nginx&#x000A;| |____Gemfile&#x000A;| |____Gemfile.lock&#x000A;| |____opt&#x000A;| | |____nginx&#x000A;| | | |____conf&#x000A;| | | | |____nginx.conf&#x000A;</code></pre>&#x000A;&#x000A;<p>The configuration is done inside the <code>Telfile</code>:</p>&#x000A;&#x000A;<div class="highlight"><pre><span class="n">user</span> <span class="s2">&quot;deploy&quot;</span>&#x000A;<span class="n">ruby</span> <span class="s2">&quot;1.9.3&quot;</span>&#x000A;<span class="n">server</span> <span class="s2">&quot;my-own-vps&quot;</span>&#x000A;&#x000A;<span class="n">apt</span> <span class="s2">&quot;deb http://ppa.launchpad.net/chris-lea/node.js/ubuntu lucid main&quot;</span><span class="p">,</span> <span class="ss">key</span><span class="p">:</span> <span class="s2">&quot;C7917B12&quot;</span>&#x000A;&#x000A;<span class="n">packages</span> <span class="sx">%w(openssl libreadline5 libreadline5-dev curl</span>&#x000A;<span class="sx">  git-core libopenssl-ruby libcurl4-openssl-dev imagemagick</span>&#x000A;<span class="sx">  libsqlite3-0 libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev</span>&#x000A;<span class="sx">  libmysqlclient-dev mysql-client mysql-server nodejs)</span>&#x000A;&#x000A;<span class="n">recipes</span> <span class="sx">%w(</span>&#x000A;<span class="sx">  install_passenger_nginx.rb)</span>&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p><code>user</code> defines the name of the account you will later use to deploy your app. This user gets added to the sudoers and your ssh key is uploaded for password-less login. <code>ruby</code> tells Teleport which version to install and <code>server</code> is the name you gave to the machine in your <code>~/.ssh/config</code>.</p>&#x000A;&#x000A;<p>As you can see you can also define customs apts and packages that should get installed. For performing special setup routines or invoking more complex tasks you can utilize the <a href="https://github.com/gurgeous/teleport/wiki/Recipes">recipes</a> feature. Recipes are standalone files that can be written in Ruby and allow for sharing and reuse. Here&#8217;s an example of how to install nginx via the passenger gem:</p>&#x000A;&#x000A;<div class="highlight"><pre><span class="n">version_gem</span> <span class="o">=</span> <span class="n">gem_version</span><span class="p">(</span><span class="s2">&quot;passenger&quot;</span><span class="p">)</span>&#x000A;<span class="n">version_installed</span> <span class="o">=</span> <span class="sb">`passenger-config --version`</span><span class="o">.</span><span class="n">strip</span>&#x000A;&#x000A;<span class="k">if</span> <span class="o">!</span><span class="n">version_gem</span>&#x000A;  <span class="nb">warn</span> <span class="s2">&quot;Passenger is not installed. Please add it to your Gemfile.&quot;</span>&#x000A;<span class="k">elsif</span> <span class="n">version_installed</span> <span class="o">==</span> <span class="n">version_gem</span><span class="o">.</span><span class="n">to_s</span>&#x000A;  <span class="n">banner</span> <span class="s2">&quot;Passenger </span><span class="si">#{</span><span class="n">version_installed</span><span class="si">}</span><span class="s2"> is already installed&quot;</span>&#x000A;<span class="k">else</span>&#x000A;  <span class="n">banner</span> <span class="s2">&quot;Installing Nginx via Passenger (installed: </span><span class="si">#{</span><span class="n">version_installed</span><span class="si">}</span><span class="s2">, gem version: </span><span class="si">#{</span><span class="n">version_gem</span><span class="si">}</span><span class="s2">)&quot;</span>&#x000A;  <span class="n">run</span> <span class="s2">&quot;passenger-install-nginx-module&quot;</span><span class="p">,</span> <span class="sx">%w(--auto --auto-download --prefix=/opt/nginx)</span>  <span class="c1"># install without prompting</span>&#x000A;  <span class="n">run</span> <span class="s2">&quot;update-rc.d nginx defaults&quot;</span>                                                      <span class="c1"># activate autostart</span>&#x000A;  <span class="n">run</span> <span class="s2">&quot;service nginx restart&quot;</span>                                                           <span class="c1"># restart nginx</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;</div>&#x000A;&#x000A;&#x000A;<p>The files directory contains files and directories that get copied over to the target machine - not much magic about that. To install system-wide gems you can place a Gemfile and Gemfile.lock inside the files directory.</p>&#x000A;&#x000A;<p>Finally you can run the setup with</p>&#x000A;&#x000A;<pre><code>$ teleport my-own-vps&#x000A;</code></pre>&#x000A;&#x000A;<p>Keep in mind that you can re-run this every time you make a change to the Telfile or add new files. Teleport strives to be idempotent and can be run  repeatedly without breaking the target machine(unless you explicitely messed up something ;)).</p>&#x000A;&#x000A;<h3>Let&#8217;s go…</h3>&#x000A;&#x000A;<p>There is much more to Teleport than what I could cover in this short post. For example you can define <a href="https://github.com/gurgeous/teleport/wiki#wiki-telfile">multiple servers with different roles</a> or <a href="https://github.com/gurgeous/teleport/wiki#wiki-infer">reverse engineering existing servers</a> which makes it very easy to generate a Telfile from your current setup. In case you want to get started head over to the <a href="https://github.com/gurgeous/teleport/wiki">project wiki</a> which contains a lot of information and examples.</p></div>
        <div class='follow'>
          <p>
            Liked this post? Follow me on
            <a class="twitter" href="https://twitter.com/dennisreimann">Twitter</a>
            or
            <a class="github" href="https://github.com/dennisreimann">GitHub</a>
          </p>
        </div>
        <div class='teaser' id='iOctocat' itemscope='itemscope' itemtype='http://schema.org/SoftwareApplication'>
          <a href='http://ioctocat.com'>
            <img alt='iPhone app for GitHub' itemprop='image' src='/images/ioctocat.png' />
          </a>
          <h3 itemprop='name'>
            <a href='http://ioctocat.com'>
              iOctocat
            </a>
          </h3>
          <p itemprop='description'>
            is GitHub in your pocket: The go to app for staying up to date with your
            projects on your
            <span itemprop='device'>iPhone, and iPod Touch.</span>
            <br />
            It is
            <a href="http://ioctocat.com/appstore-iphone" itemprop="url">available on the App Store</a>
          </p>
          <link href='http://schema.org/SocialNetworkingApplication' itemprop='SoftwareApplicationCategory' />
        </div>
      </article>
    </div>
    <div id="footer">
      <div class='vcard' id='contact'>
        <span class='fn'>Dennis Reimann</span>
        <p class='adr'>
          <span class='street-address'>Ottjen-Alldag-Str. 32</span>
          <br />
          <span class='postal-code'>D-28277</span>
          <span class='locality'>Bremen</span>
        </p>
        <p>
          <span class='web'><a class="url" href="http://dennisreimann.de/" rel="me">dennisreimann.de</a></span>
          <br />
          <span class='mail'><a class="email" href="mailto:mail@dennisreimann.de" rel="me">mail@dennisreimann.de</a></span>
          <br />
          <span class='tel'>+49 (0)151 22 63 03 17</span>
        </p>
        <p>
          <small><a href="/contact">Contact details</a></small>
        </p>
        <ul class='social'>
          <li><a href="https://github.com/dennisreimann" rel="me">GitHub</a></li>
          <li><a href="https://twitter.com/dennisreimann" rel="me">Twitter</a></li>
          <li><a href="http://www.xing.com/profile/Dennis_Reimann5" rel="me">XING</a></li>
        </ul>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-376258-21']);
        _gaq.push(['_gat._anonymizeIp']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
        })();
      //]]>
    </script>
  </body>
</html>
