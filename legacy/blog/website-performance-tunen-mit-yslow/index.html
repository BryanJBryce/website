<!DOCTYPE html>
<html>
  <head>
    <title>Website-Performance tunen mit YSlow | Dennis Reimann, Softwareentwickler</title>
    <script src='/javascripts/head.min.js'></script>
    <script type='text/javascript'>
      //<![CDATA[
        head.js(
          "https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js",
          "http://www.google-analytics.com/ga.js",
          "/fancybox/jquery.fancybox-1.3.4.pack.js",
          "/fancybox/jquery.easing-1.3.pack.js",
          "/javascripts/website.js",
          function(){Website.init()});
      //]]>
    </script>
    <link href='/atom.xml' rel='alternate' title='//dennisreimann' type='application/atom+xml' />
    <link href='/stylesheets/print.css' media='print' rel='stylesheet' type='text/css' />
    <link href='/stylesheets/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <link href='http://dennisreimann.de/blog/website-performance-tunen-mit-yslow' rel='canonical' />
    <link href='http://openid.dennisreimann.de/server' rel='openid2.provider openid.server' />
    <link href='http://openid.dennisreimann.de/dennisreimann' rel='openid2.local_id openid.delegate' />
    <!--[if IE]>
      <link href='/stylesheets/ie.css' media='screen, projection' rel='stylesheet' type='text/css' />
    <![endif]-->
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta content='BRi3ql7JvxxFP2KtBRHIV6Rfzn0ZN7xJF1NNtnEUaI8' name='google-site-verification' />
    <meta content='app-id=669642611,affiliate-data=10l5ET' name='apple-itunes-app' />
    <meta content='yahoo! widmet sich ja in letzter Zeit sehr der Untersuchung von Website-Performance und auf diesem Weg ist dann auch YSlow entstanden, mit welchem man nicht nur die Performance von Websites nach 13 Kriterien testen kann, sondern auch gleich Hinweise zur Verbesserung bekommt.' name='description' />
    <meta content='Apache, Firefox, Optimierung, Performance, Ruby on Rails, Webentwicklung, YSlow' name='keywords' />
  </head>
  <body>
    <div id="header">
      <div id='identity'>
        <a href='/' id='logo'>
          <span id='slashes'>//</span>
          <span id='name'>dennisreimann</span>
        </a>
        <div id='claim'>
          Softwareentwickler
        </div>
      </div>
    </div>
    <div id="main">
      <article>
        <header>
          <time class='pubdate' datetime='2007-09-03T20:53:00+02:00'>
            <div class='top'>Sep '07</div>
            <div class='day'> 3</div>
          </time>
          <h1>Website-Performance tunen mit YSlow</h1>
        </header>
        <div class='content'><p>Ich wollte eigentlich schon vor längerer Zeit mal was über <a href="http://developer.yahoo.com/yslow/">YSlow</a> schreiben, weil es wieder mal ein kleines und feines Addon für den Firefox und <a href="https://addons.mozilla.org/de/firefox/addon/1843">Firebug</a> ist. yahoo! widmet sich ja in letzter Zeit sehr der Untersuchung von Website-Performance und auf diesem Weg ist dann auch YSlow entstanden, mit welchem man nicht nur die Performance von Websites nach 13 Kriterien testen kann, sondern auch gleich Hinweise zur Verbesserung bekommt.</p>&#x000A;&#x000A;<p>Eben habe ich dann <a href="http://www.slashdotdash.net/articles/2007/07/31/rails-performance-tip-using-yslow">diesen Artikel</a> über die einzelnen Kriterien und die Optimierung dafür in Ruby on Rails gefunden und dachte mir, dass es sich lohnt, das Thema aufzugreifen und hier auch mal die Punkte einzeln durchzugehen und zu sagen, was ich bei <a href="http://venteria.com/">wevent</a> getunt habe.</p>&#x000A;&#x000A;<!--more-->&#x000A;&#x000A;&#x000A;<h3>Make Fewer HTTP Requests, Minify JavaScript</h3>&#x000A;&#x000A;<p>Je weniger HTTP-Requests (also Laden einzelner Dateien vom Server) gemacht werden müssen, desto schneller kann die gesamte Seite ausgeliefert werden. Hier ist es also optimal, wenn sich alle Styles in einer CSS-Datei befinden und der komplette JavaScript-Code auch in einer einzelnen Datei steht.</p>&#x000A;&#x000A;<p>Rails bringt ja von Haus aus schon vier verschiedene JavaScript-Dateien mit sich, allerdings gibt es hier das sehr gute Plugin <a href="http://synthesis.sbecker.net/pages/asset_packager">asset_packager</a>, welches nicht nur alle Script-Dateien zu einer zusammenführt, sondern das Ergebnis anschließend auch noch komprimiert. Dadurch reduziert man nicht nur die HTTP-Requests, sondern auch die Dateigröße - leider fehlen in Prototype ein paar <a href="http://dev.rubyonrails.org/ticket/7301">Semikolons</a>, so dass die Library nicht komprimiert werden kann (soll aber scheinbar noch behoben werden).</p>&#x000A;&#x000A;<p>Was Bilder angeht, so sollte man für den Fall, dass man bspw. eine grafische Navigation auf der Website hat, möglichst keine Einzelbilder für alle Zustände verwenden, sondern <a href="http://www.alistapart.com/articles/sprites">alles in einem Bild</a> zusammenfügen und dieses dann entsprechend als Hintergrund positionieren.</p>&#x000A;&#x000A;<h3>Put CSS at the Top, Move Scripts to the Bottom</h3>&#x000A;&#x000A;<p>Dürfte klar sein&#8230; CSS läd nach yahoo!-Erkenntnissen am schnellsten, wenn es im <code>HEAD</code> per link-Element eingebunden wird (kann man mit dem asset_packager Plugin per <code>stylesheet_link_merged :base</code> machen) und JavaScript-Dateien sollten möglichst am Ende des <code>BODY</code> referenziert werden (<code>javascript_include_merged :base</code>).</p>&#x000A;&#x000A;<p>Das mit dem JavaScript so weit wie möglich unten hat mich zunächst verwundert, jedoch klingen <a href="http://developer.yahoo.com/performance/rules.html#js_bottom">die Erklärungen</a> dazu einleuchtend: So lange ein Script vom Browser geladen wird, werden keine Elemente unterhalb des <code>script</code> mehr gerendert - also möglichst weit nach unten damit.</p>&#x000A;&#x000A;<h3>Remove Duplicate Scripts, Make JavaScript and CSS External</h3>&#x000A;&#x000A;<p>Die beiden Tipps sind eigentlich No-Brainer: Ein und dieselbe JavaScript-Datei nur einmal einbinden - dürfte klar sein, oder? Genauso, dass möglichst wenig CSS und Javascript inline, also direkt im Quelltext verwendet werden sollten - nicht nur unkool weil nicht <a href="http://onlinetools.org/articles/unobtrusivejavascript/">unobtrusive</a>, sondern weil es inline auch nicht gecacht werden kann.</p>&#x000A;&#x000A;<h3>Use a Content Delivery Network</h3>&#x000A;&#x000A;<p>Oha! Das spielt denke ich für den Großteil von uns keine Rolle, macht für yahoo! allerdings natürlich Sinn&#8230; ich kenn mich damit nicht aus, daher lasse ich mal jegliche Äußerungen dazu. Im <a href="http://www.slashdotdash.net/articles/2007/07/31/rails-performance-tip-using-yslow">anderen Artikel</a> wird dazu <a href="http://www.amazon.com/gp/browse.html?node=16427261">Amazons S3</a> Service als Startpunkt dafür vorgeschlagen - das scheint mir allerdings eher eine Lösung die in Richtung Asset-Host geht zu sein.</p>&#x000A;&#x000A;<h3>Gzip Components</h3>&#x000A;&#x000A;<p>Hier ist mir aufgefallen, dass wir bisher zu viel verschenkt haben, dadurch dass wir einfach nicht danach geguckt haben: Die Inhalte vor dem Senden an den Browser komprimieren. Dadurch können so ca. 75% der Dateigröße eingedampft werden, es wird von mittlerweile 90% der Browser unterstützt und selbst ich als Server-Newbie hab das in 10 Minuten eingerichtet bekommen (um das mal in überzeugenden Zahlen auszudrücken).</p>&#x000A;&#x000A;<p>So hab ichs bei unserem Apache 2.2 gemacht: Zuerst muss - sofern nicht schon erledigt - das deflate-Modul aktiviert werden. Dazu das Modul und seine Config versymlinken:</p>&#x000A;&#x000A;<pre><code>$ /etc/apache2/mods-enabled# ln -s /etc/apache2/mods-available/deflate.load&#x000A;$ /etc/apache2/mods-enabled# ln -s /etc/apache2/mods-available/deflate.conf</code></pre>&#x000A;&#x000A;&#x000A;<p>Danach noch kurz die Konfiguration anpassen:</p>&#x000A;&#x000A;<pre><code>AddOutputFilterByType DEFLATE text/html&#x000A;AddOutputFilterByType DEFLATE text/plain&#x000A;AddOutputFilterByType DEFLATE text/xml&#x000A;AddOutputFilterByType DEFLATE text/css&#x000A;AddOutputFilterByType DEFLATE text/javascript&#x000A;AddOutputFilterByType DEFLATE application/x-javascript&#x000A;AddOutputFilterByType DEFLATE application/xml&#x000A;AddOutputFilterByType DEFLATE application/x-httpd-php</code></pre>&#x000A;&#x000A;&#x000A;<p>Und den Apache reloaden: <code>$ /etc/init.d/apache2 reload</code></p>&#x000A;&#x000A;<p>Anschließend kann man <a href="http://www.gidnetwork.com/tools/gzip-test.php">hier testen</a>, ob die Inhalte jetzt komprimiert gesendet werden und wie viel es gebracht hat.</p>&#x000A;&#x000A;<h3>Avoid CSS Expressions</h3>&#x000A;&#x000A;<p><a href="http://webfx.eae.net/dhtml/cssexpr/cssexpr.html">CSS Expressions</a> sind mal wieder so eine Microsoft-Erfindung um JavaScript in CSS zu benutzen&#8230; klingt nicht nur übel, sondern isses auch - benutzt das tatsächlich wer? Einfach Finger weg&#8230;</p>&#x000A;&#x000A;<h3>Add an Expires Header</h3>&#x000A;&#x000A;<p>Mit dem Expires Header legt man fest, wie lange der Client die Serverantwort cachen kann - quasi ein Verfallsdatum für Requests. Bei der ersten Anfrage einer URL wird ein &#8220;gültig bis&#8221;-Zeitstempel mitgeliefert und bei erneuter Anfrage der gleichen URL geht kein neuer Request an den Server, wenn das Verfallsdatum noch nicht abgelaufen ist.</p>&#x000A;&#x000A;<p>Das lässt sich in der Webserver-Konfiguration vornehmen (bspw. mit <a href="http://httpd.apache.org/docs/2.0/mod/mod_expires.html">mod_expires</a> beim Apache) und sollte zumindest für die Inhalte angewandt werden, welche sich eigentlich nicht ändern (Bilder, Flash-Animationen, &#8230;). Etwas tricky wird es bei Stylesheets und JavaScripts: Werden diese auch mit einem weit in der Zukunft liegendem Expires-Datum versehen, muss bei jeder Änderung auch der Dateiname geändert werden (bspw. durch Hinzufügen einer Versionsnummer), damit die auf Clientseite gecachte Version verfällt.&#x000A;Auch hier wieder Thumbs-up für den asset_packager, welcher automatisch neue Versionen erkennt und diese unter Hinzufügen der SVN-Revisionsnummer speichert :)</p>&#x000A;&#x000A;<h3>Configure ETags</h3>&#x000A;&#x000A;<p>Geht in eine ähnliche Richtung wie die Expires Header: Die Entity (Bilder, Stylesheets, &#8230;) Tags werden benutzt, um eine eindeutige Repräsentation der Dateiversion an den Client zu senden. Bei erneuter Anfrage des Clients kann der Server mit Status 304 (Not Modified) antworten, wenn das vom Client gesendete ETag mit dem des Servers übereinstimmt.</p>&#x000A;&#x000A;<p>Es hat ein wenig gedauert, bis ich kapiert hatte, warum es negativ ausgelegt wird, wenn man ETags verwendet - die Gründe dafür lassen sich aber auf der <a href="http://developer.yahoo.net/blog/archives/2007/07/high_performanc_11.html">Diskussionsseite dazu</a> nachlesen:&#x000A;Es geht darum, ETags zu deaktivieren, falls man mehrere Server verwendet, weil sie standardmäßig nicht optimal berechnet werden.. wenn ein File auf verschiedenen Servern liegt, hat es verschiedene ETags&#8230; yahoo! weisst darauf hin, dass das kontraproduktiv ist und man ETags daher nicht nutzen soll.&#x000A;Sofern man nur einen Server verwendet, kann die Regel ignoriert werden.</p>&#x000A;&#x000A;<h3>Reduce DNS Lookups</h3>&#x000A;&#x000A;<p>Jede im Dokument verwendete Domain muss auf die IP-Adresse aufgelöst werden, bevor der Browser anfangen kann, auf dem jeweiligen Server Dokumente anzufragen. Laut yahoo! braucht jede dieser Adressauflösungen beim ersten Mal ca. 20-120 Millisekunden und wird anschließend gecacht.</p>&#x000A;&#x000A;<p>Nun ist es aber so, dass der Browser je nach Einstellungen nur eine bestimmte Anzahl von gleichzeitigen Request an die gleiche Adresse zulässt (Standard ist meistens 2). Daher heißt es in den <a href="http://developer.yahoo.com/performance/rules.html#dns_lookups">Tipps dazu</a>:</p>&#x000A;&#x000A;<blockquote cite="http://developer.yahoo.com/performance/rules.html#dns_lookups">Avoiding DNS lookups cuts response times, but reducing parallel downloads may increase response times. My guideline is to split these components across at least two but no more than four hostnames. This results in a good compromise between reducing DNS lookups and allowing a high degree of parallel downloads.</blockquote>&#x000A;&#x000A;&#x000A;<h3>Avoid Redirects</h3>&#x000A;&#x000A;<p>Sollte auch klar sein - je mehr Weiterleitungen im Hintergrund laufen, desto länger dauert es, bis die Anfrage beantwortet werden kann&#8230;</p>&#x000A;&#x000A;<h3>Abschließend ein kleiner Hinweis am Rand</h3>&#x000A;&#x000A;<p>Auf der diesjährigen @media hielt Nate Koechley einen Vortrag zur Optimierung von Website-Performance, welcher auch als <a href="http://www.vivabit.com/atmedia2007/europe/schedule/">Podcast</a> runtergeladen werden kann (lohnt sich!). In naher Zukunft wird es auch ein <a href="http://www.amazon.de/exec/obidos/ASIN/0596529309/innovatedde-21/">Buch von O’Reilley</a> zu dem Thema geben - da der Vortrag so super war, ist das schon mal direkt auf meine Wunschliste gewandert ;)</p></div>
        <div class='follow'>
          <p>
            Guter Artikel? Folge mir auf
            <a class="twitter" href="https://twitter.com/dennisreimann">Twitter</a>
            oder
            <a class="github" href="https://github.com/dennisreimann">GitHub</a>
          </p>
        </div>
        <div class='teaser' id='iOctocat' itemscope='itemscope' itemtype='http://schema.org/SoftwareApplication'>
          <a href='http://ioctocat.com'>
            <img alt='iOS app for GitHub' itemprop='image' src='/images/ioctocat.png' />
          </a>
          <h3 itemprop='name'>
            <a href='http://ioctocat.com'>iOctocat</a>
          </h3>
          <p itemprop='description'>
            ist GitHub für die Hosentasche - deine Projekte und das was dort passiert
            immer dabei mit deinem
            <span itemprop='device'>iPhone und iPod Touch.</span>
            <br />
            Die App ist
            <a href="http://ioctocat.com/appstore-iphone" itemprop="url">im App Store erhältlich</a>
          </p>
          <link href='http://schema.org/SocialNetworkingApplication' itemprop='SoftwareApplicationCategory' />
        </div>
      </article>
    </div>
    <div id="footer">
      <div class='vcard' id='contact'>
        <span class='fn'>Dennis Reimann</span>
        <p class='adr'>
          <span class='street-address'>Ottjen-Alldag-Str. 32</span>
          <br />
          <span class='postal-code'>D-28277</span>
          <span class='locality'>Bremen</span>
        </p>
        <p>
          <span class='web'><a class="url" href="http://dennisreimann.de/" rel="me">dennisreimann.de</a></span>
          <br />
          <span class='mail'><a class="email" href="mailto:mail@dennisreimann.de" rel="me">mail@dennisreimann.de</a></span>
          <br />
          <span class='tel'>+49 (0)151 22 63 03 17</span>
        </p>
        <p>
          <small><a href="/contact">Kontaktdetails</a></small>
        </p>
        <ul class='social'>
          <li><a href="https://github.com/dennisreimann" rel="me">GitHub</a></li>
          <li><a href="https://twitter.com/dennisreimann" rel="me">Twitter</a></li>
          <li><a href="http://www.xing.com/profile/Dennis_Reimann5" rel="me">XING</a></li>
        </ul>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-376258-21']);
        _gaq.push(['_gat._anonymizeIp']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
        })();
      //]]>
    </script>
  </body>
</html>
